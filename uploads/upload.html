<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload a Project</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>

    <!-- Logo (Click to go to Home) -->
    <a href="index.html" class="logo">
        <img src="images/mindcraft logo.png" height="60" width="60" alt="MindCrafts Logo">
        <img src="images/mindcraft text.png" height="60" alt="MindCrafts Text">
    </a>

    <header>
        <h1 class="main-heading">
            <span class="text-overlay">Uploads</span>
        </h1>
        <p>Upload your impressive design here and help our communty be a better place</p>
        <nav class="navbar">
            <a href="index.html">Home</a> |
            <a href="blog.html">Blogs n' Vlogs</a> |
            <a href="about.html">About</a> 
            <div class="hamburger-menu" onclick="toggleMenu()">&#9776;</div>
        </nav>
    </header>

     <!-- Sidebar -->
    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>
    <div class="sidebar" id="sidebar">
        <button class="close-btn" onclick="toggleMenu()">&#10006;</button>
        <button class="open-popup" onclick="openPopup()"><b>Contact</b></button>
        <a href="survey.html">Website Survey</a>
        <a href="uploads/upload.html" class="upload-btn">Upload Your Project</a> <!-- Adjusted path -->
    </div>

    <section class="Upload-container">
        <div class="Upload-post">
            <h2>Upload Your Craft Project</h2>
            <input type="file" id="imageInput">
            <input type="text" id="projectTitle" placeholder="Enter project title">
            <textarea id="projectDescription" placeholder="Describe your process"></textarea>
            <input type="text" id="videoEmbed" placeholder="Paste YouTube Embed Link (optional)">
            <button onclick="uploadImage()">Upload</button>
        </div>
    
    <img id="uploadedImage" style="display:none; width: 300px;">
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js"></script>
    <script>
        // Firebase Setup
        const firebaseConfig = {
            apiKey: "AIzaSyCVOOg1G5_vliX79ykPGFECv2bImWTwbHg",
            authDomain: "indcrafts-35762.firebaseapp.com",
            projectId: "mindcrafts-35762",
            storageBucket: "mindcrafts-35762.appspot.com",
            messagingSenderId: "159042521260",
            appId: "1:159042521260:web:51f929192559652b873709"
            measurementId: "G-ZSRYBHPJ27"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        async function uploadImage() {
            const fileInput = document.getElementById("imageInput");
            const file = fileInput.files[0];

            if (!file) {
                alert("Please select an image!");
                return;
            }

            const formData = new FormData();
            formData.append("file", file);
            formData.append("upload_preset", "mindcrafts_upload"); // Replace with your Cloudinary preset

            try {
                const response = await fetch("https://api.cloudinary.com/v1_1/dqxpsa3ds/image/upload", {
                    method: "POST",
                    body: formData
                });

                const data = await response.json();
                const imageUrl = data.secure_url;

                // Display uploaded image
                document.getElementById("uploadedImage").src = imageUrl;
                document.getElementById("uploadedImage").style.display = "block";

                // Store project details in Firebase Firestore
                const title = document.getElementById("projectTitle").value;
                const description = document.getElementById("projectDescription").value;
                const videoEmbed = document.getElementById("videoEmbed").value;

                await db.collection("projects").add({
                    title: title,
                    description: description,
                    imageUrl: imageUrl,
                    videoEmbed: videoEmbed,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });

                alert("Project uploaded successfully!");
            } catch (error) {
                console.error("Upload failed:", error);
            }
        }
    </script>

    <script src="../script.js"></script>
</body>
</html>
